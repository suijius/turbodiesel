{% extends "base.html" %}
{% block title %}
    {{ action.string }}
{% endblock %}
{% block breadcrumb %}
    {% if application %}
        <li>
            <a title="" href="/admin/application/{{ application.alias }}/edit">Приложение -
                "{{ application|truncatewords:2 }}"</a>
        </li>
    {% endif %}
    <li>
        <a title="" href="/admin/application/{{ application.alias }}/entity">Управление метаданными</a>
    </li>
    <li class="active">
        {{ action.string }}
    </li>
{% endblock %}

{% block center_content %}
    <div class="grid">
        <div class="grid-title">
            <div class="pull-left">
                Свойства сущности
            </div>
        </div>
        <div class="grid-content">
            <form action="." method="post" enctype="multipart/form-data" id="page" name="page">
                {# Include the hidden fields #}
                {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}
                {# Include the visible fields #}
                {% csrf_token %}
                {% for field in form.visible_fields %}
                    <div class="row-fluid">
                        <label class="span4">{{ field.label }}:</label>
                        {% if field.errors %}
                            <div class="span4">
                                {{ field }}
                            </div>
                            <div class="span4">
                                <span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg"> <span
                                        class="k-icon k-warning"> </span> {{ field.errors.0 }} </span>
                            </div>
                        {% else %}
                            <div class="span8">
                                {{ field }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
                <br class="clear">
            </form>
        </div>
    </div>
    {% for k,v in related_objects.items %}
        {% cycle  '<div class="row-fluid">' '' %}
        <div class="grid span6">
            <div class="grid-title">
                <div class="pull-left">
                    {{ k }}
                </div>
                <a href="/admin/application/{{ application.alias }}/extension/{{ k.alias }}/create/{{ extension_alias }}/{{ extension_id }}"
                   class="pull-right btn">Создание записи</a>
            </div>
            <div class="grid-content">
                {% for param_key, param_value in params.items %}
                    {% if param_key == k %}
                        <table class="table table-mod table-bordered table-mod table-striped table-condensed">
                            <thead>
                            <tr>
                                {% for field in param_value.fields %}
                                    {% if field.visible %}
                                        <th>{{ field.verbose_name }}{{ field.label }}</th>

                                    {% endif %}
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in v %}
                                <tr>
                                    {% for field in param_value.fields %}
                                        {% for key, value in row.items %}
                                            {% if key == field.name and field.visible %}
                                                <td>

                                                    <a href="/admin/application/{{ application.alias }}/extension/{{ k.alias }}/
                                        {% for key, value in row.items %}
                                            {% if key == param_value.key_field %}
                                                    {{ value }}
                                            {% endif %}
                                        {% endfor %}
                                                    /edit/" style="color: inherit;text-decoration: inherit;">
                                                        {% if field.name == "image" or field.name == "icon" or field.name == "picture" %}
                                                            <img src="/media/{{ value }}" style="max-height: 70px; max-width: 200px"/>
                                                        {% else %}
                                                            {{ value }}
                                                        {% endif %}
                                                    </a>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                </tr>
                                </tbody>
                            {% endfor %}
                        </table>
                    {% endif %}
                {% endfor %}
                <br class="clear">
            </div>
        </div>
        {% cycle  '' '</div>' %}
    {% endfor %}
    <br class="clear">
    <br class="clear">
{% endblock %}
{% block left_footer %}
    <input value="Сохранить" type="submit" class="btn btn-primary pull-right" id="submit" form="page">
{% endblock %}